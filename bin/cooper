#!/usr/bin/env ruby
require 'thor'
require 'json'
require 'cooper'

# the Thor class for the cooper command-line interface
class CooperCLI < Thor
  map '-v' => 'version'

  desc 'version', 'prints the version'
  def version
    puts "Cooper v#{Cooper::VERSION}"
  end

  desc 'reset', 'resets the cooper item'
  def reset
    Cooper.reset
  end

  desc 'update ATTRIBUTES', 'update the cooper item'
  def update(*attributes)
    changes = Hash[attributes.map { |attribute| attribute.split(':') }]
    Cooper.update(changes)
  end

  desc 'read', 'read the cooper item'
  method_option :at, type: :numeric, default: -1
  def read
    puts Cooper.read(options[:at]).to_json
  end

  desc 'rm ATTRIBUTE', 'removes the attribute from the cooper item'
  def rm(attribute)
    Cooper.delete(attribute)
  end
end

CooperCLI.start(ARGV)
